<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SPARC RPG - Project Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .tab-btn.active { border-bottom: 3px solid #f97316; color: #f97316; }
        
        /* Status colors */
        .status-not-started { background: #374151; }
        .status-in-progress { background: #f59e0b; }
        .status-review { background: #3b82f6; }
        .status-complete { background: #10b981; }
        .status-blocked { background: #ef4444; }
        
        /* Dependency graph */
        .node { cursor: pointer; }
        .node circle { stroke: #fff; stroke-width: 2px; }
        .node text { font-size: 10px; fill: #fff; }
        .link { stroke: #6b7280; stroke-width: 2px; fill: none; }
        .link.highlight { stroke: #f97316; stroke-width: 3px; }
        
        /* Pulse animation for in-progress */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        .status-in-progress { animation: pulse 2s infinite; }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen">
    <!-- Header -->
    <header class="bg-gray-800 border-b border-gray-700 px-6 py-4">
        <div class="flex items-center justify-between">
            <div class="flex items-center gap-4">
                <img src="sparc-logo.png" alt="SPARC" class="h-12" style="filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));">
                <div>
                    <h1 class="text-2xl font-bold text-orange-500">SPARC RPG</h1>
                    <p class="text-gray-400 text-sm">Project Dashboard</p>
                </div>
            </div>
            <div class="text-right">
                <p class="text-sm text-gray-400">Last updated</p>
                <p class="text-white font-mono" id="lastUpdated">-</p>
            </div>
        </div>
    </header>

    <!-- Navigation Tabs -->
    <nav class="bg-gray-800 px-6 border-b border-gray-700">
        <div class="flex space-x-8">
            <button class="tab-btn active py-4 px-2 text-sm font-medium" data-tab="progress">
                ðŸ“Š Progress Dashboard
            </button>
            <button class="tab-btn py-4 px-2 text-sm font-medium text-gray-400 hover:text-white" data-tab="dependencies">
                ðŸ”— Dependency Graph
            </button>
        </div>
    </nav>

    <!-- Tab Content -->
    <main class="p-6">
        <!-- Progress Dashboard Tab -->
        <div id="progress" class="tab-content active">
            <!-- Stats Cards -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
                <div class="bg-gray-800 rounded-lg p-6 border border-gray-700">
                    <p class="text-gray-400 text-sm uppercase tracking-wide">Overall Progress</p>
                    <p class="text-4xl font-bold text-white mt-2" id="overallProgress">0%</p>
                    <div class="w-full bg-gray-700 rounded-full h-2 mt-3">
                        <div class="bg-orange-500 h-2 rounded-full transition-all duration-500" id="progressBar" style="width: 0%"></div>
                    </div>
                </div>
                <div class="bg-gray-800 rounded-lg p-6 border border-gray-700">
                    <p class="text-gray-400 text-sm uppercase tracking-wide">Components</p>
                    <p class="text-4xl font-bold text-green-500 mt-2" id="completeCount">0</p>
                    <p class="text-gray-400 text-sm mt-1">of <span id="totalCount">18</span> complete</p>
                </div>
                <div class="bg-gray-800 rounded-lg p-6 border border-gray-700">
                    <p class="text-gray-400 text-sm uppercase tracking-wide">In Progress</p>
                    <p class="text-4xl font-bold text-yellow-500 mt-2" id="inProgressCount">0</p>
                    <p class="text-gray-400 text-sm mt-1">actively being worked on</p>
                </div>
                <div class="bg-gray-800 rounded-lg p-6 border border-gray-700">
                    <p class="text-gray-400 text-sm uppercase tracking-wide">Blocked</p>
                    <p class="text-4xl font-bold text-red-500 mt-2" id="blockedCount">0</p>
                    <p class="text-gray-400 text-sm mt-1">need attention</p>
                </div>
            </div>

            <!-- Phase Sections -->
            <div class="space-y-8">
                <!-- Core Game Engine -->
                <section>
                    <h2 class="text-lg font-semibold text-white mb-4 flex items-center">
                        <span class="w-3 h-3 bg-blue-500 rounded-full mr-2"></span>
                        Core Game Engine
                    </h2>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4" id="coreEngine"></div>
                </section>

                <!-- Seer Interface -->
                <section>
                    <h2 class="text-lg font-semibold text-white mb-4 flex items-center">
                        <span class="w-3 h-3 bg-purple-500 rounded-full mr-2"></span>
                        Seer Interface
                    </h2>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4" id="seerInterface"></div>
                </section>

                <!-- Adventure Forge -->
                <section>
                    <h2 class="text-lg font-semibold text-white mb-4 flex items-center">
                        <span class="w-3 h-3 bg-green-500 rounded-full mr-2"></span>
                        Adventure Forge
                    </h2>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4" id="adventureForge"></div>
                </section>

                <!-- Player Experience -->
                <section>
                    <h2 class="text-lg font-semibold text-white mb-4 flex items-center">
                        <span class="w-3 h-3 bg-yellow-500 rounded-full mr-2"></span>
                        Player Experience
                    </h2>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4" id="playerExperience"></div>
                </section>

                <!-- Infrastructure -->
                <section>
                    <h2 class="text-lg font-semibold text-white mb-4 flex items-center">
                        <span class="w-3 h-3 bg-red-500 rounded-full mr-2"></span>
                        Infrastructure
                    </h2>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4" id="infrastructure"></div>
                </section>
            </div>

            <!-- Legend -->
            <div class="mt-8 flex flex-wrap gap-4 text-sm">
                <div class="flex items-center"><span class="w-4 h-4 rounded status-not-started mr-2"></span> Not Started</div>
                <div class="flex items-center"><span class="w-4 h-4 rounded status-in-progress mr-2"></span> In Progress</div>
                <div class="flex items-center"><span class="w-4 h-4 rounded status-review mr-2"></span> In Review</div>
                <div class="flex items-center"><span class="w-4 h-4 rounded status-complete mr-2"></span> Complete</div>
                <div class="flex items-center"><span class="w-4 h-4 rounded status-blocked mr-2"></span> Blocked</div>
            </div>
        </div>

        <!-- Dependency Graph Tab -->
        <div id="dependencies" class="tab-content">
            <div class="bg-gray-800 rounded-lg border border-gray-700 p-4">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-lg font-semibold">Component Dependencies</h2>
                    <div class="text-sm text-gray-400">
                        <span class="inline-block w-3 h-3 rounded-full bg-blue-500 mr-1"></span> Core
                        <span class="inline-block w-3 h-3 rounded-full bg-purple-500 mr-1 ml-3"></span> Seer
                        <span class="inline-block w-3 h-3 rounded-full bg-green-500 mr-1 ml-3"></span> Forge
                        <span class="inline-block w-3 h-3 rounded-full bg-yellow-500 mr-1 ml-3"></span> Player
                        <span class="inline-block w-3 h-3 rounded-full bg-red-500 mr-1 ml-3"></span> Infra
                    </div>
                </div>
                <svg id="dependencyGraph" width="100%" height="600"></svg>
            </div>
        </div>
    </main>

    <script>
        // Project Data - Update this as progress changes
        const projectData = {
            lastUpdated: new Date().toISOString(),
            components: {
                coreEngine: [
                    { id: 'dice', name: 'Dice System', status: 'not-started', prd: '01-dice-system.md' },
                    { id: 'character', name: 'Character System', status: 'not-started', prd: '02-character-system.md' },
                    { id: 'combat', name: 'Combat System', status: 'not-started', prd: '03-combat-system.md' },
                    { id: 'session', name: 'Session Management', status: 'not-started', prd: '04-session-management.md' }
                ],
                seerInterface: [
                    { id: 'dashboard', name: 'Seer Dashboard', status: 'not-started', prd: '05-seer-dashboard.md' },
                    { id: 'ai-seer', name: 'AI Seer Assistant', status: 'not-started', prd: '06-ai-seer-assistant.md' },
                    { id: 'digital-dice', name: 'Digital Dice UI', status: 'not-started', prd: '07-digital-dice-ui.md' }
                ],
                adventureForge: [
                    { id: 'canvas', name: 'Canvas System', status: 'not-started', prd: '08-canvas-system.md' },
                    { id: 'nodes', name: 'Node System', status: 'not-started', prd: '09-node-system.md' },
                    { id: 'connections', name: 'Connection Engine', status: 'not-started', prd: '10-connection-engine.md' },
                    { id: 'validation', name: 'Validation System', status: 'not-started', prd: '11-validation-system.md' },
                    { id: 'publishing', name: 'Publishing System', status: 'not-started', prd: '12-publishing-system.md' }
                ],
                playerExperience: [
                    { id: 'char-create', name: 'Character Creation', status: 'not-started', prd: '13-character-creation.md' },
                    { id: 'session-browser', name: 'Session Browser', status: 'not-started', prd: '14-session-browser.md' },
                    { id: 'onboarding', name: 'Onboarding Tutorial', status: 'not-started', prd: '15-onboarding-tutorial.md' }
                ],
                infrastructure: [
                    { id: 'api', name: 'Backend API', status: 'not-started', prd: '16-backend-api.md' },
                    { id: 'database', name: 'Database Schema', status: 'not-started', prd: '17-database-schema.md' },
                    { id: 'auth', name: 'Authentication', status: 'not-started', prd: '18-authentication.md' }
                ]
            },
            dependencies: [
                // Infrastructure is foundation
                { from: 'database', to: 'api' },
                { from: 'auth', to: 'api' },
                // Core depends on infra
                { from: 'api', to: 'dice' },
                { from: 'api', to: 'character' },
                { from: 'api', to: 'session' },
                { from: 'character', to: 'combat' },
                { from: 'dice', to: 'combat' },
                // Seer depends on core
                { from: 'dice', to: 'digital-dice' },
                { from: 'session', to: 'dashboard' },
                { from: 'combat', to: 'dashboard' },
                { from: 'dashboard', to: 'ai-seer' },
                // Forge depends on core
                { from: 'api', to: 'canvas' },
                { from: 'canvas', to: 'nodes' },
                { from: 'nodes', to: 'connections' },
                { from: 'connections', to: 'validation' },
                { from: 'validation', to: 'publishing' },
                // Player depends on core
                { from: 'character', to: 'char-create' },
                { from: 'session', to: 'session-browser' },
                { from: 'char-create', to: 'onboarding' },
                { from: 'session-browser', to: 'onboarding' }
            ]
        };

        // Tab switching
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                btn.classList.add('active');
                document.getElementById(btn.dataset.tab).classList.add('active');
                
                if (btn.dataset.tab === 'dependencies') {
                    renderDependencyGraph();
                }
            });
        });

        // Render component card
        function renderCard(component) {
            const statusClass = `status-${component.status}`;
            return `
                <div class="rounded-lg p-4 ${statusClass} cursor-pointer hover:opacity-80 transition-opacity"
                     onclick="showPRD('${component.prd}')" title="Click to view PRD">
                    <p class="font-medium text-white">${component.name}</p>
                    <p class="text-xs text-gray-300 mt-1 capitalize">${component.status.replace('-', ' ')}</p>
                </div>
            `;
        }

        // Calculate stats
        function calculateStats() {
            const all = Object.values(projectData.components).flat();
            const total = all.length;
            const complete = all.filter(c => c.status === 'complete').length;
            const inProgress = all.filter(c => c.status === 'in-progress').length;
            const blocked = all.filter(c => c.status === 'blocked').length;
            const progress = Math.round((complete / total) * 100);

            document.getElementById('overallProgress').textContent = progress + '%';
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('completeCount').textContent = complete;
            document.getElementById('totalCount').textContent = total;
            document.getElementById('inProgressCount').textContent = inProgress;
            document.getElementById('blockedCount').textContent = blocked;
            document.getElementById('lastUpdated').textContent = new Date(projectData.lastUpdated).toLocaleString();
        }

        // Render all sections
        function renderProgress() {
            document.getElementById('coreEngine').innerHTML = 
                projectData.components.coreEngine.map(renderCard).join('');
            document.getElementById('seerInterface').innerHTML = 
                projectData.components.seerInterface.map(renderCard).join('');
            document.getElementById('adventureForge').innerHTML = 
                projectData.components.adventureForge.map(renderCard).join('');
            document.getElementById('playerExperience').innerHTML = 
                projectData.components.playerExperience.map(renderCard).join('');
            document.getElementById('infrastructure').innerHTML = 
                projectData.components.infrastructure.map(renderCard).join('');
            calculateStats();
        }

        // Show PRD (placeholder)
        function showPRD(prd) {
            alert(`PRD: prds/${prd}\n\nThis would open the PRD document.`);
        }

        // Dependency Graph with D3.js
        function renderDependencyGraph() {
            const svg = d3.select('#dependencyGraph');
            svg.selectAll('*').remove();
            
            const width = svg.node().getBoundingClientRect().width;
            const height = 600;
            
            // Get all components as nodes
            const nodes = [];
            const categoryColors = {
                coreEngine: '#3b82f6',
                seerInterface: '#a855f7',
                adventureForge: '#22c55e',
                playerExperience: '#eab308',
                infrastructure: '#ef4444'
            };
            
            Object.entries(projectData.components).forEach(([category, components]) => {
                components.forEach(comp => {
                    nodes.push({
                        id: comp.id,
                        name: comp.name,
                        category: category,
                        color: categoryColors[category],
                        status: comp.status
                    });
                });
            });

            // Create links
            const links = projectData.dependencies.map(d => ({
                source: d.from,
                target: d.to
            }));

            // Force simulation
            const simulation = d3.forceSimulation(nodes)
                .force('link', d3.forceLink(links).id(d => d.id).distance(100))
                .force('charge', d3.forceManyBody().strength(-400))
                .force('center', d3.forceCenter(width / 2, height / 2))
                .force('collision', d3.forceCollide().radius(50));

            // Draw links
            const link = svg.append('g')
                .selectAll('line')
                .data(links)
                .enter()
                .append('line')
                .attr('class', 'link')
                .attr('marker-end', 'url(#arrowhead)');

            // Arrowhead marker
            svg.append('defs').append('marker')
                .attr('id', 'arrowhead')
                .attr('viewBox', '-0 -5 10 10')
                .attr('refX', 20)
                .attr('refY', 0)
                .attr('orient', 'auto')
                .attr('markerWidth', 8)
                .attr('markerHeight', 8)
                .append('path')
                .attr('d', 'M 0,-5 L 10,0 L 0,5')
                .attr('fill', '#6b7280');

            // Draw nodes
            const node = svg.append('g')
                .selectAll('g')
                .data(nodes)
                .enter()
                .append('g')
                .attr('class', 'node')
                .call(d3.drag()
                    .on('start', dragstarted)
                    .on('drag', dragged)
                    .on('end', dragended));

            node.append('circle')
                .attr('r', 25)
                .attr('fill', d => d.color)
                .attr('opacity', d => d.status === 'complete' ? 1 : 0.6);

            node.append('text')
                .attr('text-anchor', 'middle')
                .attr('dy', '.35em')
                .text(d => d.name.split(' ')[0]);

            // Tooltip
            node.append('title')
                .text(d => `${d.name}\nStatus: ${d.status}`);

            // Simulation tick
            simulation.on('tick', () => {
                link
                    .attr('x1', d => d.source.x)
                    .attr('y1', d => d.source.y)
                    .attr('x2', d => d.target.x)
                    .attr('y2', d => d.target.y);

                node.attr('transform', d => `translate(${d.x},${d.y})`);
            });

            function dragstarted(event) {
                if (!event.active) simulation.alphaTarget(0.3).restart();
                event.subject.fx = event.subject.x;
                event.subject.fy = event.subject.y;
            }

            function dragged(event) {
                event.subject.fx = event.x;
                event.subject.fy = event.y;
            }

            function dragended(event) {
                if (!event.active) simulation.alphaTarget(0);
                event.subject.fx = null;
                event.subject.fy = null;
            }
        }

        // Initialize
        renderProgress();
    </script>
</body>
</html>
